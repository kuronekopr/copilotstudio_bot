# 01_Chat_UI_Overview

## UI 全体構成

### レイアウト構成
```
┌─────────────────────────────────────────────┐
│ Header: 「チャットボット」 | [×]クローズボタン   │
├─────────────────────────────────────────────┤
│                                               │
│  Message History Area                        │
│  （チャットメッセージ、画像サムネイル）        │
│  - 過去メッセージスクロール表示                │
│  - 画像サムネイル（max 5個）表示              │
│                                               │
├─────────────────────────────────────────────┤
│ Input Area:                                   │
│ [+画像を選択] [テキスト入力欄] [送信ボタン]   │
│ 画像数: 0/5                                   │
└─────────────────────────────────────────────┘
```

### ウィンドウ形式
- **ポップアップスタイル**：既存ウェブサイト上のフローティングウィンドウ（Direct Line Webchat標準）
- **サイズ**：幅 400px、高さ 600px（レスポンシブ対応）
- **位置**：右下固定
- **Z-index**：10000（他要素より前面）

### メッセージ履歴エリア
- スクロール可能領域（height 450px 程度）
- ユーザーメッセージ：右寄せ、青背景
- ボット応答：左寄せ、灰色背景
- システムメッセージ：中央、ベージュ背景、小さいフォント

### 画像サムネイル表示
- **最大表示数**：5枚
- **レイアウト**：横一列（スクロール可能）
- **サイズ**：各 60px × 60px
- **操作**：
  - ホバーで [×] ボタン表示（削除可能）
  - クリックで拡大表示（オーバーレイ）
  - ドラッグドロップで順序変更可能

### 入力エリア
```
[📎] [テキスト入力欄（複数行対応）] [送信ボタン]
      残り画像数: 3/5
```
- **ファイル選択**：[📎] アイコンクリック → ネイティブファイルダイアログ
- **テキスト入力**：複数行対応、Enter で送信（Shift+Enter で改行）
- **送信ボタン**：無効状態は薄くグレーアウト

## ポップアップ設計原則

### 外観
- **背景**：白（#FFFFFF）
- **境界線**：薄いグレー（#E0E0E0）
- **シャドウ**：box-shadow: 0 4px 12px rgba(0,0,0,0.15)
- **フォント**：sans-serif, 14px

### インタラクション
- **スクロール**：スムーススクロール（scroll-behavior: smooth）
- **ボタン**：ホバー時はわずかに背景色変化
- **入力フォーカス**：青い下線（outline-color: #0078D4）

### モバイル対応
- **小画面**：ポップアップ全体を画面いっぱい表示
- **タッチ操作**：ボタン最小 44px × 44px
- **キーボード**：仮想キーボード対応

## 最大5枚の画像上限と UI 表示

### 画像選択フロー
1. ユーザー [📎] クリック
2. ファイルダイアログ開く
3. 複数選択可能（Ctrl/Cmd + Click）
4. 選択後、サムネイル表示エリアに追加
5. 5枚到達時、「これ以上追加できません」メッセージ表示
6. [📎] ボタン非活性化

### 画像削除フロー
1. サムネイルの [×] ボタンクリック
2. 確認ダイアログ表示（「この画像を削除してもよろしいですか？」）
3. 「削除」クリック → 画像削除、サムネイル再配置
4. [📎] ボタン再活性化

## PII マスク確認画面への遷移

### 遷移条件
- ユーザーが画像とテキスト（任意）を送信
- フロントエンド：画像バリデーション成功（size, format）
- バックエンド：OCR + PII 検出実行
- **必須：** PII マスク確認画面を表示（マスク済画像のみ送信を強制）

### 確認画面ポップアップ
- **オーバーレイ**：セミトランスパレント黒（opacity 0.5）
- **ダイアログ**：中央に表示（width 500px）
- **内容**：
  - タイトル「PII が検出されました」
  - 検出ノード（メール、電話、住所等）
  - マスク済画像プレビュー
  - 信頼度レベル別の色分け（緑/オレンジ/赤）
  - 手動追加ボタン
  - 「送信」と「キャンセル」ボタン
